---
title: "Statistical Analysis"
author: "Jim Scotland"
date: "Revised March 26, 2018"
output: 
  github_document: 
    fig_height: 8
    fig_width: 8
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE, warning=TRUE, include=FALSE, paged.print=FALSE}
library(xml2)
library(readxl)
library(readr)
library(tidyr)
library(dplyr)
library(purrr)
library(ggplot2)
library(directlabels)
library(lubridate)
library(broom)
library(scales)

# Set options to limit sci notation and decimal places
options(scipen = 999, digits = 3)

# =======================================================================
# 
# Code Needed to Load Analysis Datasets
# Complete r file for data import available here:
# Springboard_Data_Science/01_data_import.R
# 
# =======================================================================

# Data accessed at
# https://wonder.cdc.gov/

# Import CDC Suicide Data (edited version with additional footer data deleted) 
suicides_df <- read_tsv("data_edited/CDC_FirearmSuicide_1999-2016.txt")

# Remove duplicate/empty columns, make Rate numeric
suicides_df$Notes <- NULL
suicides_df$'State Code' <- NULL
suicides_df$'Year Code' <- NULL
suicides_df$`Crude Rate` <- as.numeric(suicides_df$`Crude Rate`)

# Standardize and sepcify variable names (plan to merge w/ homicide data)
suicides_df <- suicides_df %>%
  rename(state = State) %>%
  rename(year = Year) %>%
  rename(sui_cnt = Deaths) %>%
  rename(sui_pop = Population) %>%
  rename(sui_rate = 'Crude Rate')

# DC & RI too few for calculation, replace NA w/ calculation
suicides_df <- mutate(suicides_df, sui_rate = ifelse(is.na(sui_rate), round(sui_cnt / sui_pop * 100000, 1), sui_rate))

# Repeat process w/ appropriate variable adjustments for homicide data
homicides_df <- read_tsv("data_edited/CDC_FirearmHomicide_1999-2016.txt")

head(homicides_df)

homicides_df$Notes <- NULL
homicides_df$'State Code' <- NULL
homicides_df$'Year Code' <- NULL
homicides_df$`Crude Rate` <- as.numeric(homicides_df$`Crude Rate`)

homicides_df <- homicides_df %>%
  rename(state = State) %>%
  rename(year = Year) %>%
  rename(hom_cnt = Deaths) %>%
  rename(hom_pop = Population) %>%
  rename(hom_rate = 'Crude Rate')

# Same issue as suicides data - replace NA hom_rate w/ calculation
homicides_df <- mutate(homicides_df, hom_rate = ifelse(is.na(hom_rate), round(hom_cnt / hom_pop * 100000, 1), hom_rate))

# Import CDC Population Data (baseline for joining suicide/homicide data)
population_df <- read_tsv("data_edited/CDC_PopEst_1990-2016.txt")
head(population_df)

# Similar adjustments for population table
population_df$Notes <- NULL
population_df$`Yearly July 1st Estimates Code` <- NULL
population_df$`State Code` <- NULL

population_df <- population_df %>%
  rename(state = State) %>%
  rename(year = `Yearly July 1st Estimates`) %>%
  rename(pop = Population)
  
# Filter for Years applicable to available CDC data
population_df <- population_df %>%
  filter(year >= 1999)

# =======================================================================
# 
# Add State Land Area from Census Bureau for Population Density Calculations
# 
# =======================================================================

# Data accessed at
# https://factfinder.census.gov/faces/tableservices/jsf/pages/productview.xhtml?src=bkmk

land_area <- read_xlsx("data_edited/state_land_area.xlsx")

# Add population density to population table
population_df <- population_df %>%
  left_join(land_area, by = "state") %>%
  mutate(pop_density = pop / land_area)


# =======================================================================
# 
# Data Merge - CDC Suicides, CDC Homicides, CDC Population
# 
# =======================================================================

# Create standard join key variable for most common table join 
join_key <- c("state", "year")

# Join Population base table w/ homicides and suicides tables
gun_deaths_df <- left_join(population_df, homicides_df, by = join_key) %>%
  left_join(suicides_df, by = join_key) %>%
  select(-hom_pop, -sui_pop)

# Replace NA in Suicides/Homicides with Mean for respective State
# Calculate hom_rate and sui_rate to replace NA values 
gun_deaths_df <- gun_deaths_df %>%
  group_by(state) %>%
  mutate(hom_cnt = ifelse(is.na(hom_cnt), as.integer(mean(hom_cnt, na.rm = TRUE)), hom_cnt)) %>%
  mutate(sui_cnt = ifelse(is.na(sui_cnt), as.integer(mean(sui_cnt, na.rm = TRUE)), sui_cnt)) %>%
  mutate(hom_rate = ifelse(is.na(hom_rate), round(hom_cnt / pop * 100000, 1), hom_rate)) %>% 
  mutate(sui_rate = ifelse(is.na(sui_rate), round(sui_cnt / pop * 100000, 1), sui_rate))

# =======================================================================
# 
# Import Region/Subregion data to join on State for higher level analysis
# 
# =======================================================================

# Regional data information accessed at
# https://www2.census.gov/geo/docs/maps-data/maps/reg_div.txt

regions_df <- read_excel("data_edited/State_FIPS_Codes.xlsx")

# Convert code fields to integer
regions_df$fips_st <- as.integer(regions_df$fips_st)
regions_df$reg_code <- as.integer(regions_df$reg_code)
regions_df$subreg_code <- as.integer(regions_df$subreg_code)

# Create region and subregion fields w/ code+name for sorting/labeling purposes
regions_df <- regions_df %>%
  unite(region, reg_code, reg_name, sep = "-", remove = FALSE) %>%
  unite(subregion, subreg_code, subreg_name, sep = "-", remove = FALSE)

# =======================================================================
# 
# Import Boston University School of Public Health Gun Law Data
# 
# =======================================================================

# Data accessed at
# https://www.statefirearmlaws.org/table.html

state_laws_df <- read.csv("data_edited/state_gun_law_database.csv")
state_codes_df <- read_xlsx("data_edited/state_gun_laws_codebook.xlsx")

# Clean up category names in State Firearm Codes
state_codes_df <- state_codes_df %>%
  select(cat_code = `Category Code`, cat = Category, sub_cat = `Sub-Category`, var_name = `Variable Name`)

# Filter state law data for 1999-2016 period only
state_laws_df <- state_laws_df %>%
  filter(year >= 1999 & year <= 2016)

# Create simplified table with total laws for general analysis
state_laws_total_df <- state_laws_df %>%
  select(state, year, lawtotal)

# Collapse 134 individual variables in to 14 larger category groupings
laws_cat_df <- state_laws_df %>%
  mutate(deal_reg = dealer + dealerh + recordsall + recordsdealerh + recordsall + 
           reportdealer + reportdealerh + reportall + reportallh + purge + residential + 
           theft + security + inspection + liability + junkgun) %>%
  mutate(buy_reg = waiting + waitingh + permit + permith + permitlaw + fingerprint +
           training + registration + registrationh + defactoreg + defactoregh + age21handgunsale + 
           age18longgunsale + age21longgunsale + age21longgunsaled + loststolen + onepermonth) %>%
  mutate(high_risk = felony + violent + violenth + violentpartial + invcommitment + 
           invoutpatient + danger + drugmisdemeanor + alctreatment + alcoholism) %>%
  mutate(bkgrnd_chk = universal + universalh + gunshow + gunshowh + universalpermit + universalpermith + 
           backgroundpurge + threedaylimit + mentalhealth + statechecks + statechecksh) %>%
  mutate(ammo_reg = ammlicense + ammrecords + ammpermit + ammrestrict + amm18 +
           amm21h + ammbackground) %>%
  mutate(poss_reg = age21handgunpossess + age18longgunpossess + age21longgunpossess + 
           gvro + gvrolawenforcement + college + collegeconcealed + elementary + opencarryh +
           opencarryl + opencarrypermith + opencarrypermitl) %>%
  mutate(conceal_reg = permitconcealed + mayissue + showing + ccrevoke + ccbackground +
           ccbackgroundnics + ccrenewbackground) %>%
  mutate(assault_mag = assault + onefeature + assaultlist + assaultregister + assaulttransfer +
           magazine + tenroundlimit + magazinepreowned) %>%
  mutate(child_acc = lockd + lockp + lockstandards + locked + capliability + capaccess +
           capuses + capunloaded + cap18 + cap16 + cap14) %>%
  mutate(gun_traff = traffickingbackground + traffickingprohibited + traffickingprohibitedh +
           strawpurchase + strawpurchaseh + microstamp + personalized) %>%
  mutate(stnd_grnd = nosyg) %>%
  mutate(pre_empt = preemption + preemptionbroad + preemptionnarrow) %>%
  mutate(immunity_ = immunity) %>%
  mutate(dom_viol = mcdv + mcdvdating + mcdvsurrender + mcdvsurrendernoconditions +
           mcdvsurrenderdating + mcdvremovalallowed + mcdvremovalrequired + incidentremoval +
           incidentall + dvro) %>%
  select(state, year, contains("_"))

# =======================================================================
# 
# Import Giffords Law Center Gun Law Data
# 
# =======================================================================

# Data accessed at 
# http://lawcenter.giffords.org/

# Import Giffords Law Center data, compiled in CSV from website data
giff_grd_df <- read.csv("data_edited/giffords_gunlawscorecard.csv")

# Import LetterGardeConverter to translate letter to numeric grade
grd_conv_df <- read.csv("data_edited/LetterGradeConverter.csv")

# Reverse numerical ordering of death_rnk to 1 for Fewest 50 for Most
# More intuitive to have rank on both reflect greater safety
giff_grd_df <- giff_grd_df %>%
  mutate(death_rnk = 51 - death_rnk)

# Calculate numerical grade from grd_conv_df table, re-arrange table
giff_grd_df <- giff_grd_df %>%
  left_join(grd_conv_df, by = c("law_grd" = "Letter")) %>%
  select(state, year, law_grd, law_score = GPA, law_rnk, death_rnk, bkgrnd_chk) %>%
  arrange(state, year)

# Create aggreagte data table w/ avg scores and ranks by state
giff_agg_df <- giff_grd_df %>%
  group_by(state) %>%
  summarise(avg_score = round(mean(law_score), 2), avg_law_rnk = round(mean(law_rnk), 2), 
            avg_death_rnk = round(mean(death_rnk), 2), avg_bkgrnd = round(mean(bkgrnd_chk), 2))

# =======================================================================
# 
# Import CDC Suicide Data ALL METHODS
# 
# =======================================================================

# Data accessed at
# https://wonder.cdc.gov/

# Import CDC Suicide Data, ALL METHODS (edited version with additional footer data deleted) 
all_suicides_df <- read_tsv("data_edited/CDC_AllSuicides_State_1999-2016.txt")

# Remove duplicate/empty columns, make Rate numeric
all_suicides_df$Notes <- NULL
all_suicides_df$'State Code' <- NULL
all_suicides_df$'Year Code' <- NULL
all_suicides_df$`Crude Rate` <- as.numeric(all_suicides_df$`Crude Rate`)

# Standardize and sepcify variable names (plan to merge w/ homicide data)
all_suicides_df <- all_suicides_df %>%
  rename(state = State) %>%
  rename(year = Year) %>%
  rename(all_sui_cnt = Deaths) %>%
  rename(all_sui_pop = Population) %>%
  rename(all_sui_rate = 'Crude Rate')

# =======================================================================
# 
# Import Gun Ownership Data
# 
# =======================================================================

# Data accessed at
# http://injuryprevention.bmj.com/content/22/3/216

gun_own_2013_df <- read_excel("data_edited/gun_ownership_rates_2013.xlsx")


gun_own_prx_df <- read_excel("data_edited/gun_ownership_proxy.xlsx")


# Gun Ownership Proxy: Retain only proxy variable for 1999-2106,
# convert proxy to percentage and year to integer
gun_own_prx_df <- gun_own_prx_df %>%
  filter(year >= 1999) %>%
  mutate(own_proxy = proxy/100, year = as.integer(year)) %>%
  select(state, year, own_proxy)


# That's all for the data importing.

```


### CDC Firearm Homicide & Suicide Data  

#### Plot total numbers of Firearm Suicides & Homicides to highlight problem at the start.  

```{r gun_deaths}
gun_deaths_df %>%
  group_by(year) %>%
  summarise(Homicide = sum(hom_cnt), Suicide = sum(sui_cnt)) %>%
  gather(key = "Firearm_Death", value = "Deaths", c(Homicide, Suicide)) %>%
  ggplot(aes(x = year, y = Deaths, color = Firearm_Death)) +
  geom_line(size = 1.5) +
  expand_limits(y = 0) +
  scale_y_continuous(labels = comma) +
  ylab("Annual CDC Firearm Fatality Totals") +
  xlab("Year") +
  labs(color = "Firearm Deaths") +
  labs(title = "CDC Annual Firearm Deaths, Homicide vs Suicide", 
       subtitle = "National Totals 1999-2016") +
  labs(caption = "Centers for Disease Control Data for 1999-2016") +
  theme(legend.position = "right")
```
  

##### Total firearm suicides far exceed firearm homicides and have climbed steadily since around 2006 to a total of just under 23,000.  

#### Basic statistical summary for Firearm Homicide rates for 1999-2016  
```{r stat_sum_homicides}
gun_deaths_df %>%
  ungroup(state) %>%
  summarize(N = n(), Min = min(hom_rate), Max = max(hom_rate), Avg = mean(hom_rate), 
            Median = median(hom_rate), IQR = IQR(hom_rate), SD = sd(hom_rate))
```
##### Max of 30.7 stems from exceedingly high DC rates noted on import, will filter out DC for plots to avoid skewing of y-axis.  

#### Same summary for Firearm Suicide rates  
```{r stat_sum_suicides}
gun_deaths_df %>%
  ungroup(state) %>%
  summarize(N = n(), Min = min(sui_rate), Max = max(sui_rate), Avg = mean(sui_rate), 
            Median = median(sui_rate), IQR = IQR(sui_rate), SD = sd(sui_rate))
```
##### Average firearm suicide rate is nearly 2X the average firearm homicide rate.  

#### Run correlation on Homicide vs Suicide to check for linear relationship.  
```{r cor_homicide_suicide}
gun_deaths_df %>%
  left_join(regions_df, by = "state") %>%
  filter(usps_st != "DC") %>%
  ungroup(state) %>%
  summarize(N = n(), cor = cor(sui_rate, hom_rate))
```
##### Correlation of 0.13, minimal relationship between homicide and suicide rates.  

#### State level Suicide Rate vs Homicide Rate
```{r hom_vs_sui_scatter}
gun_deaths_df %>%
  left_join(regions_df, by = "state") %>%
  filter(usps_st != "DC") %>%
  group_by(region, usps_st) %>%
  summarise(hom_rate = mean(hom_rate), sui_rate = mean(sui_rate)) %>%
  ggplot(aes(x = hom_rate, y = sui_rate, color = region, label = usps_st)) +
  geom_text() +
  stat_smooth(method = "lm", se = FALSE, color = "blue") +
  expand_limits(y = 0, x = 0) +
  geom_vline(linetype = 2, color = "red", xintercept = 3.75) +
  geom_hline(linetype = 2, color = "red", yintercept = 7.50) +
  labs(color = "Region") +
  ylab("Average CDC Firearm Suicide Rate") +
  xlab("Average CDC Firearm Homicide Rate") +
  labs(title = "Firearm Suicide Rates by Firearm Homicide Rates", 
       subtitle = "Rate: Deaths per 100,000 Population") +
  labs(caption = "Centers for Disease Control Data for 1999-2016; DC excluded to avoid skewing of scale.") +
  theme(legend.position = "right")
```
  

##### Plot confirms lack of relation and reveals highest homicide rates in the South (LA, MS and AL), highest suicide rates in the West (WY, MT and AK) and large clusters of low rates for both in the Northeast (MA, CT, RI, NY and NJ). 

#### State level "Suicide Rate - Homicide Rate" by Region
```{r state_sui-hom_rates}
gun_deaths_df %>%
  left_join(regions_df, by = "state") %>%
  filter(usps_st != "DC") %>%
  group_by(region, usps_st) %>%
  summarise(Avg_Suicide_Rate = mean(sui_rate), Avg_Homicide_Rate = mean(hom_rate),
            Suicide_Homicide_Diff = Avg_Suicide_Rate - Avg_Homicide_Rate) %>%
  arrange(desc(Suicide_Homicide_Diff), desc(usps_st)) %>%
  select(region, usps_st, Suicide_Homicide_Diff) %>%
  ggplot(aes(x = reorder(usps_st, -Suicide_Homicide_Diff), y = Suicide_Homicide_Diff, fill = region)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  facet_wrap(~ region, scales = "free_y") +
  labs(color = "Region") +
  ylab("Avg Firearm Suicide Rate Minus Avg Firearm Homicide Rate") +
  xlab("State") +
  labs(title = "Assessing the Greater Gun Threat: Firearm Suicides vs Firearm Homicides", 
       subtitle = "Bars Indicate Amount by which Suicide Rate Exceeds Homicide Rate") +
  labs(caption = "Centers for Disease Control Data for 1999-2016; DC excluded to avoid skewing of scale.") +
  theme(legend.position = "none")
```
  

##### Firearm homicide rates exceed firearm suicide rates in only 6 of 50 states. The largest rate differentials appear in several western states, suggesting regional influences. Turn focus to firearm suicides only.  

#### Create table distinguishing gun suicides vs other suicides
```{r sui_method_df, echo=TRUE}
sui_method_df <- all_suicides_df %>%
  left_join(gun_deaths_df, by = join_key) %>%
  select(state, year, pop, all_cnt = all_sui_cnt, all_rate = all_sui_rate, 
         gun_cnt = sui_cnt, gun_rate = sui_rate) %>%
  mutate(gun_pct = gun_cnt/all_cnt, 
         other_cnt = all_cnt - gun_cnt, 
         other_rate = all_rate - gun_rate)
summary(sui_method_df)
```
  
##### Table reveals wildly disparate data across all categories. Investigate on subregion level per indications from plot above.  

#### Boxplot OVERALL Suicide Rates Across Subregions
```{r sui_all_subregion_box}
sui_method_df %>%
  left_join(regions_df, by = "state") %>%
  group_by(subregion, year) %>%
  summarise(all_rate = sum(all_cnt)/sum(pop) * 100000,
            gun_rate = sum(gun_cnt)/sum(pop) * 100000,
            other_rate = sum(other_cnt)/sum(pop) * 100000) %>%
  ggplot(aes(x = subregion, y = all_rate, color = subregion)) +
  geom_boxplot() +
  ylab("CDC Overall Suicide Rate") +
  xlab("Year") +
  labs(title = "Regional Suicide Rates ALL Methods", 
       subtitle = "Rate: Deaths per 100,000 Population") +
  labs(caption = "Centers for Disease Control Data for 1999-2016") +
  theme(legend.position = "right") +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
```
  
##### Coastal states have lower overall suicide rates, with the mountain region much higher which may be a partial result of significantly lower overall population levels.  

#### Boxplot of OVERALL State Suicide Rates Grouped by Population Quartile
```{r sui_all_state_box_popq}
pop_labels <- c(
      '1' = "Low Population",
      '2' = "Moderate Low Population",
      '3' = "Moderate High Population",
      '4' = "High Population"
)

sui_method_df %>%
  left_join(regions_df, by = "state") %>%
  group_by(subregion, usps_st, year) %>%
  summarise(all_rate = sum(all_cnt)/sum(pop) * 100000,
            gun_rate = sum(gun_cnt)/sum(pop) * 100000,
            other_rate = sum(other_cnt)/sum(pop) * 100000,
            avg_suicides = mean(all_cnt),
            avg_pop = mean(pop)) %>%
  ggplot(aes(x = reorder(usps_st, -all_rate), y = all_rate, fill = subregion)) +
  geom_boxplot() +
  facet_wrap(~ ntile(avg_pop, 4), scales = "free_x", labeller = as_labeller(pop_labels)) +
  labs(fill = "Subregion") +
  ylab("CDC Overall Suicide Rate") +
  xlab("State") +
  labs(title = "Overall Suicide Rates by State Grouped by Population Quartile", 
       subtitle = "Rate: Deaths per 100,000 Population") +
  labs(caption = "Centers for Disease Control Data for 1999-2016") +
  theme(legend.position = "right")
```
  
##### Plot dispels issues of small population Mountain states driving higher suicide rates. Mountain states post highest overall suicide rates across all four population quartiles.  
  
#### Plot Population Effect as Function of Population DENSITY Instead
```{r pop_density_plot, message=FALSE, warning=FALSE}
# Check for population effect as function of Population Density instead.
sui_method_df %>%
  left_join(regions_df, by = "state") %>%
  left_join(population_df, by = c("state", "year", "pop")) %>%
  group_by(subregion, usps_st) %>%
  filter(usps_st != "DC") %>%
  summarise(all_rate = sum(all_cnt)/sum(pop) * 100000,
            gun_rate = sum(gun_cnt)/sum(pop) * 100000,
            other_rate = sum(other_cnt)/sum(pop) * 100000,
            avg_suicides = mean(all_cnt),
            avg_pop = mean(pop),
            pop_dens = mean(pop_density)) %>%
  ggplot(aes(x = log(pop_dens), y = all_rate, label = usps_st, color = subregion)) +
  geom_text() +
  stat_smooth(method = "lm", se = FALSE, color = "blue") +
  labs(color = "Subregion") +
  ylab("CDC Overall Suicide Rate") +
  xlab("Population Density - Log Scale") +
  labs(title = "Overall Suicide Rates by Population Density", 
       subtitle = "Rate: Deaths per 100,000 Population") +
  labs(caption = "Centers for Disease Control Data for 1999-2016") +
  theme(legend.position = "right")

# Correlation equation for Population Density and Overall Suicide Rate
cor(sui_method_df$all_rate, log(population_df$pop_density))^2
```
##### Plot supports connection between lower population density and higher suicide rates; however, a clear disconnect between the Mountain and Great Plains states emerges.  
  
#### Lineplot of Suicide Rates by Method Across Subregions
```{r subreg_sui_method}
sui_method_df %>%
  left_join(regions_df, by = "state") %>%
  group_by(subregion, year) %>%
  summarise(all_rate = sum(all_cnt)/sum(pop) * 100000,
            gun_rate = sum(gun_cnt)/sum(pop) * 100000,
            other_rate = sum(other_cnt)/sum(pop) * 100000) %>%
  gather(key = "Method", value = "rate", c(other_rate, gun_rate))  %>%
    ggplot(aes(x = year, y = rate, color = Method)) +
    geom_line(size = 1) +
    facet_wrap(~ subregion) +
    expand_limits(y = 0) +
    ylab("CDC Suicide Rates, Firearm & Other") +
    xlab("Year") +
    labs(title = "Regional Suicide Rates by Firearm vs Other Methods", 
         subtitle = "Rate: Deaths per 100,000 Population") +
    labs(caption = "Centers for Disease Control Data for 1999-2016") +
    theme(legend.position = "right")
```
  
##### Time series plot of suicides broken out by firearm/other indicates major regional differences. Coastal states exhibit much lower firearm rates at levels that appear more steady compared to other methods and other states.  

#### Many-Mini Plot of Suicide Rates by Method at State Level
```{r many_mini_sui_method}
sui_method_df %>%
  left_join(regions_df, by = "state") %>%
  group_by(state, year) %>%
  summarise(all_rate = sum(all_cnt)/sum(pop) * 100000,
            gun_rate = sum(gun_cnt)/sum(pop) * 100000,
            other_rate = sum(other_cnt)/sum(pop) * 100000) %>%
  gather(key = "Method", value = "rate", c(other_rate, gun_rate))  %>%
  ggplot(aes(x = year, y = rate, color = Method)) +
  geom_line(size = 1) +
  facet_wrap(~ state) +
  ylab("CDC Suicide Rates, Firearm & Other") +
  xlab("Year") +
  labs(title = "State Level Suicide Rates by Firearm vs Other Methods", 
       subtitle = "Rate: Deaths per 100,000 Population, 1999-2016") +
  labs(caption = "Centers for Disease Control Data for 1999-2016") +
  theme(legend.position = "bottom") +
  theme(axis.title.x=element_blank(),
        axis.ticks.x=element_blank(),
        axis.text.x=element_blank())
```
  
##### Displays variation by state with large variations in small population states jumping out.

#### Partition States into Above/Below Average Suicide Rate, Calculate Percentage Using Firearm  
```{r calc_gunpct, echo=FALSE}
sui_method_df %>%
  group_by(year) %>%
  mutate(abv_avg_rate = all_rate > mean(all_rate)) %>%
  group_by(abv_avg_rate) %>%
  summarise(n = n(), deaths = sum(all_cnt), avg_gun_pct = mean(gun_pct))
```
  
##### Since 1999, guns accounted for an average 58% of suicides in states with above average suicide rates and 48% of suicides in states with below average rates (average rates calculated annually).  

### Gun Ownership Rates  

#### Statistical Summary of National Gun Ownerhip Rates
```{r stats_nat_ownrate, echo=FALSE}
gun_own_2013_df %>%
  summarize(N = n(), Min = min(own_rate), Max = max(own_rate), Avg = mean(own_rate), 
            Median = median(own_rate), IQR = IQR(own_rate), SD = sd(own_rate))
```

##### Average ownership rate of 33% ranging from 5% to 61.7%.  

#### Summary at Regional Level
```{r stats_reg_ownrate, echo=FALSE}
gun_own_2013_df %>%
  left_join(regions_df, by = "state") %>%
  group_by(region) %>%
  summarize(N = n(), Min = min(own_rate), Max = max(own_rate), Avg = mean(own_rate), 
            Median = median(own_rate), IQR = IQR(own_rate), SD = sd(own_rate))
```

##### Below average rates in Northeast, above average in West and South - regional dynamic again.  

#### Boxplot of Ownership Rates by Region
```{r plot_reg_ownrate}
gun_own_2013_df %>%
  left_join(regions_df, by = "state") %>%
  ggplot(aes(x = region, y = own_rate, color = region, label = usps_st)) +
  geom_boxplot() +
  geom_text(position = "jitter") +
  scale_y_continuous(labels = function(x) paste0(x*100, "%")) +
  labs(color = "Region") +
  ylab("Gun Ownership Rate") +
  xlab("Region") +
  labs(title = "Gun Ownership Rates by Region", 
       subtitle = "Household Gun Ownership Rates for 2013") +
  labs(caption = "Data cited by Kalesan B, Villarreal MD, Keyes KM, et al Gun ownership and social gun culture Injury Prevention 2016;22:216-220.") +
  theme(legend.position = "none")
```

### Gun Ownership Rates vs CDC Suicide Rates
 
#### Regression Plot FIREARM Suicide Rate vs Gun Ownership Rate for 2013  
```{r lr_ownrate_v_fsr_all}
gun_deaths_df %>%
  filter(year == 2013) %>%
  left_join(gun_own_2013_df, by = "state") %>%
  left_join(regions_df, by = "state") %>%
  ggplot(aes(x = own_rate, y = sui_rate, label = usps_st, color = region)) +
  geom_text() +
  stat_smooth(method = "lm", se = FALSE, color = "blue") +
  scale_x_continuous(labels = function(x) paste0(x*100, "%")) +
  labs(color = "Region") +
  ylab("CDC Firearm Suicide Rate (2013)") +
  xlab("Gun Ownership Rate") +
  labs(title = "Firearm Suicide Rates by Gun Ownership Rates", 
       subtitle = "Household Gun Ownership Rates for 2013, CDC Rate: Deaths per 100,000 Population") +
  labs(caption = "Data cited by Kalesan B, Villarreal MD, Keyes KM, et al Gun ownership and social gun culture Injury Prevention 2016;22:216-220.") +
  theme(legend.position = "bottom")

```
  
#### Regression Calculation  
```{r lr_ownrate_fsr_all, echo=FALSE}
gun_deaths_df %>%
  filter(year == 2013) %>%
  left_join(gun_own_2013_df, by = "state") %>%
  ungroup(state) %>%                                 # Don't know why needed to ungroup, but it worked?
  summarize(N = n(), r2 = cor(own_rate, sui_rate)^2)
```
  
##### The r2 of 0.547 indicates solid relationship between suicide rate and gun ownership.  
  
  
#### Regression Plot FIREARM Suicide Rate (FSR) vs Gun Ownership Rate by Region
```{r lr_ownrate_v_fsr_reg}
gun_deaths_df %>%
  filter(year == 2013) %>%
  left_join(gun_own_2013_df, by = "state") %>%
  left_join(regions_df, by = "state") %>%
  ggplot(aes(x = own_rate, y = sui_rate, label = usps_st, color = region)) +
  geom_text() +
  stat_smooth(method = "lm", se = FALSE) +
  scale_x_continuous(labels = function(x) paste0(x*100, "%")) +
  facet_grid(. ~ region)  +
  labs(color = "Region") +
  ylab("CDC Firearm Suicide Rate (2013)") +
  xlab("Gun Ownership Rate") +
  labs(title = "Regional Firearm Suicide Rates by Gun Ownership Rates", 
       subtitle = "Household Gun Ownership Rates for 2013, CDC Rate: Deaths per 100,000 Population") +
  labs(caption = "Data cited by Kalesan B, Villarreal MD, Keyes KM, et al Gun ownership and social gun culture Injury Prevention 2016;22:216-220.") +
  theme(legend.position = "none")
```
  
#### Regression Calculations
```{r lr_ownrate_fsr_reg, echo=FALSE}
gun_deaths_df %>%
  filter(year == 2013) %>%
  left_join(gun_own_2013_df, by = "state") %>%
  left_join(regions_df, by = "state") %>%
  group_by(region) %>%
  summarize(N = n(), r2 = cor(own_rate, sui_rate)^2)
```
  
##### The r2 values range from 0.360 in Midwest to 0.487 in South. The lack of ownership data creates limitations.  

#### Firearm Suicide Rates Grouped by Ownership Rate Tier
```{r own_rate_tier_fsr}
own_rate_labels <- c(
    '1' = "Low",
    '2' = "Medium",
    '3' = "High"
)

# Firearm suicide rates grouped by ownership rate
gun_deaths_df %>%
  left_join(regions_df, by = "state") %>%
  filter(year == 2013) %>%
  inner_join(gun_own_2013_df, by = "state") %>%
  filter(usps_st != "DC") %>%
  ggplot(aes(x = reorder(usps_st, -sui_rate), y = sui_rate, fill = region)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  facet_grid(. ~ ntile(own_rate, 3), labeller = as_labeller(own_rate_labels)) +
  labs(fill = "Region") +
  ylab("CDC Firearm Suicide Rate (2013)") +
  xlab("State") +
  labs(title = "States Ranked by Firearm Suicide Rate, Grouped by Gun Ownership Tier", 
       subtitle = "Tier 1 = Low, Tier 2 = Med, Tier 3 = High, Household Gun Ownership Rates for 2013, CDC Rate: Deaths per 100,000 Population") +
  labs(caption = "Data cited by Kalesan B, Villarreal MD, Keyes KM, et al Gun ownership and social gun culture Injury Prevention 2016;22:216-220.") +
  theme(legend.position = "bottom")
```
  
##### Plot supports strong connection between gun ownership rates and higher firearm suicide levels.

### Giffords Law Center Rankings

#### Basic Histogram of Giffords Law Grades
```{r giff_grd_hist, message=FALSE, warning=FALSE}
giff_grd_df %>%
  ggplot(aes(x = law_score)) +
  geom_histogram() +
  scale_x_reverse() +
  facet_grid(. ~ year) +
  ylab("States (n)") +
  xlab("Giffords Gun Law Grade (GPA Scale)") +
  labs(title = "Distribution of Giffords Gun Law Grades", subtitle = "GPA Scale: 4 = A, 0 = F") +
  labs(caption = "Giffords Law Center Data for 2014-2016")
```
  
##### Failing grades clearly dominate the distribution.  

#### Statistical Summary by Region, Year  
```{r giff_summary_regyr, echo=FALSE, message=FALSE, warning=FALSE}
giff_grd_df %>%
  left_join(regions_df, by = "state") %>%
  group_by(region, year) %>%
  summarize(N = n(), Min = min(law_score), Max = max(law_score), AvgScore = mean(law_score),
            Median = median(law_score), IQR = IQR(law_score), SD = sd(law_score))
```


#### Mofified Histogram of Giffords Law Grades
```{r mod_giff_hist, message=FALSE, warning=FALSE}
giff_grd_df %>%
  left_join(regions_df, by = "state") %>%
  filter(reg_code >= 0) %>%
  ggplot(aes(x = law_grd, y = death_rnk, label = usps_st, color = region)) +
  geom_text() +
  facet_grid(. ~ year) +
  labs(color = "Region") +
  ylab("State Gun Death Rank") +
  xlab("Giffords Gun Law Grade") +
  labs(title = "Giffords Gun Law Grades Plotted by Gun Death Rank",
       subtitle = "Rank: 1 = Best, 50 = Worst, Gun Death Rankings Include Homicide and Suicide Deaths") +
  labs(caption = "Giffords Law Center Data for 2014-2016")
```
  
##### Modified histogram highlights F scores and worse Death Rank dominated by South and West. Of the 20 worst death rankings, between 18 and 20 had a law grade of F over three years.  

#### Gun Death Rank by Gun Law Rank Across Region and Year
```{r giff_law_vs_death, message=FALSE, warning=FALSE}
giff_grd_df %>%
  left_join(regions_df, by = "state") %>%
  ggplot(aes(x = law_rnk, y = death_rnk, label = usps_st, color = region)) +
  facet_grid(year ~ region) +
  geom_text() +
  stat_smooth(method = "lm", se = FALSE) +
  expand_limits(y = 0) +
  labs(color = "Region") +
  ylab("State Gun Death Rank") +
  xlab("State Gun Law Rank") +
  labs(title = "Giffords Regional Gun Death Rank by Gun Law Rank", 
       subtitle = "1 = Best, 50 = Worst, Gun Death Rankings Include Homicide and Suicide Deaths") +
  theme(legend.position = "none") +
  labs(caption = "Giffords Law Center Data for 2014-2016")
```
  
##### Clear regional variations supported by calculated r2 values.
```{r giff_law_vs_death_r2, echo=FALSE, fig.height=5, fig.width=5, message=FALSE, warning=FALSE}
giff_grd_df %>%
  left_join(regions_df, by = "state") %>%
  group_by(region) %>%
  summarize(N = n(), r2 = cor(law_rnk, death_rnk)^2)
```
  
##### Regression lines and r2 values support the existence of strong regional variation.  
  
### Giffords Law Rankings & CDC Firearm Suicides  
  
#### CDC Firearm Suicide Rate by Gun Law Rank Across Region and Year
```{r giff_law_vs_fsr, message=FALSE, warning=FALSE}
giff_grd_df %>%
  filter(year >= 2014) %>%
  left_join(gun_deaths_df, by = join_key) %>%
  left_join(regions_df, by = "state") %>%
  ggplot(aes(x = law_rnk, y = sui_rate, label = usps_st, color = region)) +
  geom_text(position = "jitter") +
  stat_smooth(method = "lm", se = FALSE) +
  facet_grid(year ~ region) +
  expand_limits(y = 0) +
  labs(color = "Region") +
  ylab("CDC Firearm Suicide Rate") +
  xlab("Giffords Gun Law Rank") +
  labs(title = "Giffords Gun Law Rank by CDC Firearm Suicide Rate", 
       subtitle = "Rank: 1 = Best, 50 = Worst, Rate: Deaths per 100,000 Population") +
  labs(caption = "Based on 2015 data from Giffords Law Center and Centers for Disease Control") +
  theme(legend.position = "none")
```
  
##### Plot bears strong resemblence to similar plot for Gun Death Rank, with some notable variations.  

#### Regression Calculation Overall 
```{r giff_fsr_r2_all, echo=FALSE, fig.width=5, message=FALSE, warning=FALSE}
giff_grd_df %>%
  filter(year >= 2014) %>%
  left_join(gun_deaths_df, by = join_key) %>%
  left_join(regions_df, by = "state") %>%
  summarize(N = n(), r2 = cor(sui_rate, law_rnk)^2)

```
#### Regression Calculation Regional   
```{r giff_fsr_r2_reg, echo=FALSE, fig.width=6, message=FALSE, warning=FALSE}

giff_grd_df %>%
  filter(year >= 2014) %>%
  left_join(gun_deaths_df, by = join_key) %>%
  left_join(regions_df, by = "state") %>%
  group_by(region) %>%
  summarize(N = n(), r2 = cor(sui_rate, law_rnk)^2)
```

##### Northeast shows strongest relationship between rank and firearm suicide rate with r2 of 0.816 while the overall r2 of 0.594 indicates a solid relationship across all regions.  

#### Overall Suicide Rates by Giffords F Grade
```{r giff_f_allsui_setup, message=FALSE, warning=FALSE, include=FALSE}
sui_method_df %>%
  filter(year == 2016) %>%
  summarize(avg_all_rate = mean(all_rate))
```

```{r giff_f_allsui, message=FALSE, warning=FALSE}
sui_method_df %>%
  filter(year == 2016) %>%
  mutate(Abv_Average_Rate = all_rate > mean(all_rate)) %>%
  gather(key = "cause", value = "rate", c(other_rate, gun_rate))  %>%
  left_join(regions_df, value = "state") %>%
  inner_join(giff_grd_df, by = join_key) %>%
  mutate(Giffords_F = law_score == 0) %>%
    ggplot(aes(x = reorder(usps_st, all_rate), y = rate, fill = cause)) +
    facet_grid(Giffords_F ~ Abv_Average_Rate, labeller = label_both, scales = "free_y") +
    geom_col() +
    geom_hline(linetype = 2, aes(yintercept = mean(all_rate))) +
    coord_flip() +
    labs(fill = "Suicide Rate") +
    ylab("Suicide Rate (2016)") +
    xlab("State") +
    labs(title = "Overall Suicide Rates and States Scoring F on Giffords Gun Law Grade", 
         subtitle = "True/False Panels: Above Average Suicide Rate and Giffords Grade of F, Dashed Line Indicates Average") +
    labs(caption = "Giffords Law Center & Centers for Disease Control Data for 2016") +
    theme(legend.position = "right")
```

##### Table Count for Plot Above  
```{r giff_tbl_cnt, echo=FALSE, message=FALSE, warning=FALSE}
sui_method_df %>%
  filter(year == 2016) %>%
  mutate(other_rate = all_rate - gun_rate, Abv_Average_Rate = all_rate > mean(all_rate)) %>%
  inner_join(giff_grd_df, by = join_key) %>%
  mutate(Giffords_F = law_score == 0) %>%
  select(Giffords_F, Abv_Average_Rate) %>%
  table()
```

##### Out of 50 states, 41 Abv Avg Suicide ratings were indicated correctly by Gifford F. Displayed data for 2016. Slightly lower accuracy in 2014 and 2015 at 38/50 each.  

### BU Public Health State Firearm Law Data

#### Regional Gun Law Totals 1999-2016
```{r bu_lawtot_reg, message=FALSE, warning=FALSE}
state_laws_total_df %>%
  left_join(regions_df, by = "state") %>%
  group_by(region, year) %>%
  select(region, year, lawtotal) %>%
  summarise(tot_laws = sum(lawtotal)) %>%
  ggplot(aes(x = year, y = tot_laws, color = region)) +
  geom_line(size = 1) +
  labs(color = "Year") +
  ylab("Total Gun Laws") +
  xlab("Year") +
  labs(title = "Total Gun Law Counts by Region, 1999-2016", 
       subtitle = "") +
  labs(caption = "Boston University School of Public Health: State Gun Law Database") +
  theme(legend.position = "bottom")
```
  
##### Definite regional differences and some regions decreasing gun laws.  

#### Summary Statistics by Region
```{r bu_statsum_reg, echo=FALSE, fig.width=6, message=FALSE, warning=FALSE}
state_laws_total_df %>%
  left_join(regions_df, by = "state") %>%
  select(region, year, lawtotal) %>%
  group_by(region) %>%
  summarize(N = n(), Min = min(lawtotal), Max = max(lawtotal), Avg = mean(lawtotal), 
            Median = median(lawtotal), IQR = IQR(lawtotal), SD = sd(lawtotal))
```
  
##### The Northeast clearly has the strongest laws overall but also the widest spread. Figures for the West appear to be skewed higher by just a few states with an average of 23.3 but a median of only 11.  
  
#### Revisiting Regional Law Count Trend Using Median State Law Counts  
```{r median_law_count_plot, message=FALSE, warning=FALSE}
# Add regional layer to above plot CALCULATING MEDIAN INSTEAD
state_laws_total_df %>%
  left_join(regions_df, by = "state") %>%
  group_by(region, year) %>%
  select(region, year, lawtotal) %>%
  summarise(tot_laws = median(lawtotal)) %>%
  ggplot(aes(x = year, y = tot_laws, color = region)) +
  geom_line(size = 1) +
  expand_limits(y = 0) +
  labs(color = "Year") +
  ylab("Median State Gun Law Count") +
  xlab("Year") +
  labs(title = "Median State Gun Law Counts by Region, 1999-2016", 
       subtitle = "") +
  labs(caption = "Boston University School of Public Health: State Gun Law Database") +
  theme(legend.position = "bottom")
```
##### Median state law counts display absence of broader national change with a few states driving the overall change.  
  

#### Many-Mini Plot of Law Totals by State 1999-2016
```{r many_mini_lawtotals, message=FALSE, warning=FALSE}
state_laws_total_df %>%
  left_join(regions_df, by = "state") %>%
  group_by(region, state, year) %>%
  select(region, state, year, lawtotal) %>%
  summarise(tot_laws = sum(lawtotal)) %>%
  ggplot(aes(x = year, y = tot_laws, color = region)) +
  geom_line(size = 1) +
  facet_wrap(~ state) +
  theme(axis.title.x=element_blank(),
        axis.ticks.x=element_blank(),
        axis.text.x=element_blank()) +
  labs(color = "Region") +
  ylab("Total Gun Laws") +
  xlab("Region") +
  labs(title = "Total Gun Law Counts by State, 1999-2016", 
       subtitle = "") +
  labs(caption = "Boston University School of Public Health: State Gun Law Database") +
  theme(legend.position = "bottom")
```


#### Net Change in Gun Law Counts by State  
```{r law_netchg_setup, message=FALSE, warning=FALSE, include=FALSE}
law_chg_df <- state_laws_total_df %>%
  select(state, year, lawtotal) %>%
  filter(year == 1999 | year == 2016) %>%
  spread(year, lawtotal, sep = "_") %>%
  mutate(law_chg = year_2016 - year_1999, law_quant = ntile(law_chg, 4)) %>%
  arrange(desc(law_chg)) %>%
  print()

law_quant_lbl <- c(
  '1' = "1 - Reduced",
  '2' = "2 - Unchanged",
  '3' = "3 - Small Increase",
  '4' = "4 - Large Increase"
)

fsr_chg_df <- sui_method_df %>%
  select(state, yr = year, gun_rate) %>%
  filter(yr == 1999 | yr == 2016) %>%
  spread(yr, gun_rate, sep = "_") %>%
  mutate(fsr_chg = yr_2016 - yr_1999, fsr_quant = ntile(-fsr_chg, 4)) %>%
  arrange(desc(fsr_chg)) %>%
  print()

fsr_law_avg_df <- law_chg_df %>%
  left_join(fsr_chg_df, by = "state") %>%
  group_by(law_quant) %>%
  summarise(N = n(),  Avg_Law_Chg = mean(law_chg), Avg_FSR_Chg = mean(fsr_chg))
```

```{r law_netchg_plot, message=FALSE, warning=FALSE}
law_chg_df %>%
  left_join(regions_df, by = "state") %>%
  ggplot(aes(x = reorder(usps_st, law_chg), y = law_chg, fill = region)) +
  geom_bar(stat = "identity") +
  geom_hline(data = fsr_law_avg_df, aes(yintercept = Avg_Law_Chg), lty = 2) +
  geom_text(data = fsr_law_avg_df, aes(label = paste("Avg = ", round(Avg_Law_Chg, 2))), 
            x = -Inf, y = fsr_law_avg_df$Avg_Law_Chg, hjust = -0.1, vjust = -0.5, size = 4,
            inherit.aes = FALSE) +
  facet_wrap(~ law_quant, labeller = as_labeller(law_quant_lbl), scales = "free_x") +
  labs(fill = "Region") +
  ylab("Net Change in State Gun Laws") +
  xlab("State") +
  labs(title = "Net Change in Gun Law Counts by State, 1999-2016", 
       subtitle = "Grouped into Quartiles by Net Change") +
  labs(caption = "Boston University School of Public Health: State Gun Law Database") +
  theme(legend.position = "bottom") +
  labs(color = "Region")
```

### State Firearm Law Data vs CDC Firearm Suicide Rates  

#### Annual Firearm Suicide Rate by Number of State Gun Laws  
```{r fsr_vs_lawtotal_all, message=FALSE, warning=FALSE}
cor_law_fsr_all <- sui_method_df %>%
  left_join(state_laws_total_df, by = join_key) %>%
  left_join(regions_df, by = "state") %>%
  filter(usps_st != "DC") %>%
  group_by(state) %>%
  summarize(lawtotal = mean(lawtotal), gun_rate = mean(gun_rate)) %>%
  summarize(N = n(), r2 = cor(gun_rate, lawtotal)^2) %>%
  print()

sui_method_df %>%
  left_join(state_laws_total_df, by = join_key) %>%
  left_join(regions_df, by = "state") %>%
  filter(usps_st != "DC") %>%
  group_by(region, usps_st) %>%
  summarize(lawtotal = mean(lawtotal), gun_rate = mean(gun_rate)) %>%
  ggplot(aes(x = lawtotal, y = gun_rate, color = region, label = usps_st)) +
  geom_text() +
  geom_text(data = cor_law_fsr_all, aes(label = paste("r2 = ", round(r2, 3))), 
            x = Inf, y = Inf, hjust = 1.1, vjust = 1.5, size = 5, color = "blue",
            inherit.aes = FALSE) +
  stat_smooth(method = "lm", se = FALSE, color = "blue") +
  ylab("Average CDC Firearm Suicide Rate") +
  xlab("Average Gun Laws by State") +
  labs(color = "Region") +
  labs(title = "Firearm Suicide Rate by Number of State Gun Laws", 
       subtitle = "Rate: Deaths per 100,000 Population, Number of Laws 1999-2016") +
  labs(caption = "Sources: Boston University School of Public Health, Centers for Disease Control") +
  theme(legend.position = "right")
```
  
#### Firearm Suicide Rate by Gun Laws by Region  
```{r fsr_vs_lawtotal_reg, message=FALSE, warning=FALSE}
cor_law_fsr_reg <- sui_method_df %>%
  left_join(state_laws_total_df, by = join_key) %>%
  left_join(regions_df, by = "state") %>%
  filter(usps_st != "DC") %>%
  group_by(region, state) %>%
  summarize(lawtotal = mean(lawtotal), gun_rate = mean(gun_rate)) %>%
  group_by(region) %>%
  summarize(N = n(), r2 = cor(gun_rate, lawtotal)^2) %>%
  print()
# r2 low of 0.484 in South, 0.736 in West, 0.814 in Northeast and 0.841 in Midwest

# Plot by region total laws against firearm suicide rates
sui_method_df %>%
  filter(state != "District of Columbia") %>%
  left_join(state_laws_total_df, by = join_key) %>%
  left_join(regions_df, by = "state") %>%
  group_by(region, usps_st) %>%
  summarize(lawtotal = mean(lawtotal), gun_rate = mean(gun_rate)) %>%
  ggplot(aes(x = lawtotal, y = gun_rate, color = region, label = usps_st)) +
  geom_text() +
  facet_wrap(~ region) +
  geom_text(data = cor_law_fsr_reg, aes(label = paste("r2 = ", round(r2, 3))), 
            x = 95, y = 13, hjust = 0.75, vjust = -0.25, size = 3.5, color = "blue",
            inherit.aes = FALSE) +
  stat_smooth(method = "lm", se = FALSE) +
  ylab("Average CDC Firearm Suicide Rate") +
  xlab("Average Gun Laws by State") +
  labs(color = "Region") +
  labs(title = "Annual Firearm Suicide Rate by Number of State Gun Laws by Region", 
       subtitle = "Rate: Deaths per 100,000 Population, Number of Laws 1999-2016") +
  labs(caption = "Sources: Boston University School of Public Health, Centers for Disease Control") +
  theme(legend.position = "right")

```
  
##### All regions exhibit negative relationship, more laws correlate with lower firearm suicide rates.  
  
#### Firearm Suicide Rate Grouped by Law Change Quartile  
```{r fsrchg_lawchg_qrt, message=FALSE, warning=FALSE}
fsr_chg_df %>%
  filter(state != "District of Columbia") %>%
  left_join(regions_df, by = "state") %>%
  left_join(law_chg_df, by = "state") %>%
  filter(law_quant %in% c(1, 2, 3, 4)) %>%
  ggplot(aes(x = reorder(usps_st, -fsr_chg), y = fsr_chg, fill = region)) +
  geom_bar(stat = "identity") +
  facet_wrap(~ law_quant, labeller = as_labeller(law_quant_lbl), scale = "free_x") +
  geom_hline(data = fsr_law_avg_df, aes(yintercept = Avg_FSR_Chg), lty = 2) +
  geom_text(data = fsr_law_avg_df, aes(label = paste("Avg = ", round(Avg_FSR_Chg, 2))), 
            x = Inf, y = fsr_law_avg_df$Avg_FSR_Chg, hjust = 1, vjust = -0.5, size = 3.2,
            inherit.aes = FALSE) +
  ylab("Change in CDC Firearm Suicide Rate from 1999 to 2016") +
  xlab("State") +
  labs(fill = "Region") +
  labs(title = "Net Change in Firearm Suicide Rate by Change in State Gun Laws Quartile", 
       subtitle = "Rate: Deaths per 100,000 Population, Quartiles by Change in Number of Laws 1999-2016") +
  labs(caption = "Sources: Boston University School of Public Health, Centers for Disease Control") +
  theme(legend.position = "right")
```
  
#### Barplot of Average FSR Change by Law Change Quartile  
```{r message=FALSE, warning=FALSE}
law_chg_df %>%
  left_join(fsr_chg_df) %>%
  group_by(law_quant) %>%
  summarise(N = n(), Avg_Law_Chg = mean(law_chg), Avg_FSR_Chg = mean(fsr_chg)) %>%
  ggplot(aes(x = law_quant_lbl, y = Avg_FSR_Chg, fill = as.factor(round(Avg_Law_Chg)))) +
  geom_bar(stat = "identity") +
  geom_dl(aes(label = paste("+", round(Avg_FSR_Chg, 2), " Deaths/100K")), 
          method = list("last.points", cex = 1, hjust = 0.5, vjust = -0.25)) +
  ylab("Average Change in CDC Firearm Suicide Rate") +
  xlab("Change in Number of Gun Laws") +
  labs(fill = "Avg Law Change") +
  labs(title = "Average Change in Firearm Suicide Rate by State Gun Law Change Quartile", 
       subtitle = "Rate: Deaths per 100,000 Population, Quartiles by Change in Number of Laws 1999-2016") +
  labs(caption = "Sources: Boston University School of Public Health, Centers for Disease Control") +
  theme(legend.position = "bottom")
```
  
##### States that reduced gun laws saw average FSR increase 5X that of states that increased laws significantly.  
#### States that Reduced Gun Restrictions: FSR by Reduction in Laws  
```{r reduced_state_plots, message=FALSE, warning=FALSE}
sui_method_df %>%
  filter(state != "District of Columbia") %>%
  left_join(state_laws_total_df, by = join_key) %>%
  left_join(regions_df, by = "state") %>%
  left_join(law_chg_df, by = "state") %>%
  filter(law_quant == 1) %>%
  ggplot(aes(x = year, y = gun_rate, color = lawtotal)) +
  geom_point() +
  stat_smooth(method = "lm", se = FALSE) +
  facet_wrap(~ state) +
  geom_text(aes(label = paste("Law Change =", law_chg)),
            x = 2010, y = 17, hjust = 0.5, vjust = 1, size = 3.5, color = "blue", inherit.aes = FALSE) +
  scale_y_continuous(expand = c(0, 0), limits = c(0,18)) +
  ylab("Annual CDC Firearm Suicide Rate") +
  xlab("Year") +
  labs(color = "Total Laws") +
  labs(title = "Firearm Suicide Rate Trend: States that Reduced Gun Laws", 
       subtitle = "Rate: Deaths per 100,000 Population, Number of Laws 1999-2016") +
  labs(caption = "Sources: Boston University School of Public Health, Centers for Disease Control") +
  theme(legend.position = "bottom")
```
  
##### Every state that reduced gun laws experienced an increase in firearm suicides. However, it should be noted that nationally suicide rates rose from 10.5 to almost 14 per 100,000 during this time period.  

#### States that Sharply Increased Gun Restrictions: FSR by Increase in Laws  
```{r increased_state_plots, message=FALSE, warning=FALSE}
sui_method_df %>%
  filter(state != "District of Columbia") %>%
  left_join(state_laws_total_df, by = join_key) %>%
  left_join(regions_df, by = "state") %>%
  left_join(law_chg_df, by = "state") %>%
  filter(law_quant == 4) %>%
  ggplot(aes(x = year, y = gun_rate, color = lawtotal)) +
  geom_point() +
  stat_smooth(method = "lm", se = FALSE) +
  facet_wrap(~ state) +
  geom_text(aes(label = paste0("Law Change = +", law_chg)),
            x = 2010, y = 17, hjust = 0.5, vjust = 1, size = 3.5, color = "blue", inherit.aes = FALSE) +
  scale_y_continuous(expand = c(0, 0), limits = c(0,18)) +
  ylab("Annual CDC Firearm Suicide Rate") +
  xlab("Year") +
  labs(color = "Total Laws") +
  labs(title = "Firearm Suicide Rate Trend: States that Significantly Increased Gun Laws", 
       subtitle = "Rate: Deaths per 100,000 Population, Number of Laws 1999-2016") +
  labs(caption = "Sources: Boston University School of Public Health, Centers for Disease Control") +
  theme(legend.position = "bottom")

```
  
##### Colorado and Oregon show moderately rising suicide trendlines in spite of added gun laws. Most other trendlines were nearly flat or declining. Again, this is all occurring as overall national suicide rates climbed from 10.5 to 14 per 100,000.


